<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administration ‚Äì Centre de loisirs</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo-badge">CL</div>
    <div>
      <h1>Administration ‚Äì Centre de loisirs</h1>
      <p>Gestion des billets, enregistrement des √©tudiants et agents, statistiques.</p>
    </div>
  </div>
</header>

<main>

  <!-- 1. Connexion ADMIN -->
  <section id="admin-login-card" class="card">
    <h2>Connexion administrateur</h2>

    <p style="margin-bottom:0.6rem;">
      Acc√®s r√©serv√© aux administrateurs (agents avec un r√¥le contenant <strong>admin</strong>).
    </p>

    <div class="form-row">
      <label for="adminLogin">Code admin (login agent) :</label>
      <input type="text" id="adminLogin" placeholder="ex : admin01" />
    </div>

    <div class="form-row">
      <label for="adminPassword">Mot de passe :</label>
      <input type="password" id="adminPassword" placeholder="Mot de passe" />
    </div>

    <button id="btnAdminLogin" type="button" class="btn-primary">
      Se connecter
    </button>

    <p id="admin-login-message" class="status"></p>
  </section>

  <!-- 2. Zone apr√®s connexion ADMIN -->
  <div id="admin-app-zone" style="display:none;">

    <!-- Bandeau admin + modes -->
    <section class="card">
      <h2>Panneau d'administration</h2>

      <p class="status" style="margin-bottom:0.8rem;">
        Connect√© :
        <strong id="admin-connected-name"></strong>
        (<span id="admin-connected-role"></span>)
      </p>

      <div class="mode-navigation">
        <button id="btnAdminModeSaisie" type="button" class="mode-btn active">
          Saisie / Enregistrement
        </button>
        <button id="btnAdminModeGestion" type="button" class="mode-btn">
          Gestion & statistiques
        </button>
        <button id="btnAdminLogout" type="button" class="btn-danger" style="margin-left:auto;">
          Se d√©connecter
        </button>
      </div>
    </section>

    <!-- === MODE 1 : Saisie / Enregistrement === -->
    <div id="admin-zone-saisie">

      <!-- Enregistrer un √©tudiant -->
      <section class="card" id="admin-etudiants">
        <h2>Enregistrer un √©tudiant</h2>

        <p class="status">
          Ajoute un √©tudiant dans la collection <strong>etudiants</strong> (pour le tarif √©tudiant).<br>
          Le num√©ro √©tudiant est <strong>g√©n√©r√© automatiquement</strong> au format :
          <code>UNIV-XX-1234</code>.
        </p>

        <div class="form-row">
          <label for="admin-etu-universite">Universit√© / √âcole *</label>
          <input
            type="text"
            id="admin-etu-universite"
            placeholder="Ex : HAFIA, USTG, Kofi Annan..."
            required
          />
        </div>

        <div class="form-row">
          <label for="admin-etu-nom">Nom *</label>
          <input
            type="text"
            id="admin-etu-nom"
            placeholder="Ex : BAH"
            required
          />
        </div>

        <div class="form-row">
          <label for="admin-etu-prenom">Pr√©nom *</label>
          <input
            type="text"
            id="admin-etu-prenom"
            placeholder="Ex : LAMA"
            required
          />
        </div>

        <div class="form-row">
          <label for="admin-etu-email">E-mail</label>
          <input
            type="email"
            id="admin-etu-email"
            placeholder="exemple@domaine.com"
          />
        </div>

        <div class="form-row">
          <label for="admin-etu-telephone">T√©l√©phone</label>
          <input
            type="text"
            id="admin-etu-telephone"
            placeholder="Num√©ro de t√©l√©phone"
          />
        </div>

        <div class="form-row" style="flex-direction:row; align-items:center; gap:0.5rem;">
          <input type="checkbox" id="admin-etu-actif" checked />
          <label for="admin-etu-actif" style="margin:0;">√âtudiant actif</label>
        </div>

        <button id="btnCreateEtudiant" type="button" class="btn-primary">
          Enregistrer l‚Äô√©tudiant
        </button>

        <p id="admin-etu-message" class="message" style="display:none;"></p>
      </section>

      <!-- Cr√©ation d'un agent -->
      <section class="card">
        <h2>Cr√©er un agent</h2>

        <p class="status" style="margin-bottom:0.8rem;">
          Ajoute un agent dans la collection <strong>agents</strong> (utilis√© pour la connexion sur le poste agent).
        </p>

        <div class="form-row">
          <label for="admin-agent-login">Login agent <span style="color:#ef4444;">*</span></label>
          <input type="text" id="admin-agent-login" placeholder="Ex : agent01" />
        </div>

        <div class="form-row">
          <label for="admin-agent-password">Mot de passe <span style="color:#ef4444;">*</span></label>
          <input type="password" id="admin-agent-password" placeholder="Mot de passe" />
        </div>

        <div class="form-row">
          <label for="admin-agent-nom">Nom / pr√©nom (optionnel)</label>
          <input type="text" id="admin-agent-nom" placeholder="Nom de l'agent" />
        </div>

        <div class="form-row">
          <label for="admin-agent-role">
            R√¥le / poste <span style="color:#ef4444;">*</span> <br />
            <span class="status">Ex : <em>admin</em>, <em>billets entr√©e</em>, <em>resto</em>, <em>jeux internes</em>‚Ä¶</span>
          </label>
          <input type="text" id="admin-agent-role" placeholder="Ex : admin, billets entr√©e, resto..." />
        </div>

        <div class="form-row" style="flex-direction:row; align-items:center; gap:0.6rem;">
          <input type="checkbox" id="admin-agent-actif" checked />
          <label for="admin-agent-actif" style="margin:0;">Agent actif</label>
        </div>

        <button id="btnCreateAgent" type="button" class="btn-secondary">
          Cr√©er l'agent
        </button>

        <p id="admin-agent-message" class="status"></p>
      </section>

    </div> <!-- /admin-zone-saisie -->

    <!-- === MODE 2 : Gestion & statistiques === -->
    <div id="admin-zone-gestion" style="display:none;">

      <!-- Gestion des billets (CSV) -->
      <section class="card">
        <h2>üìÇ Gestion des billets (CSV)</h2>

        <h3 style="margin-bottom:0.5rem;">Import de billets</h3>

        <p>Type de billets √† importer :</p>
        <div style="margin-bottom:0.5rem;">
          <label class="radio-inline">
            <input type="radio" name="importType" value="entree" checked />
            <span>Billets d'entr√©e (parc)</span>
          </label>

          <label class="radio-inline">
            <input type="radio" name="importType" value="interne" />
            <span>Billets internes (jeux)</span>
          </label>
        </div>

        <p class="status" style="margin-bottom:0.3rem;">
          Pour les billets d'entr√©e : <code>numero_billet;type_acces;prix;tarif_universite;statut</code><br />
          Pour les billets internes : <code>numero_billet;type_billet;prix</code> (le statut sera mis √† "Non utilis√©" par d√©faut).
        </p>

        <div class="form-row">
          <input type="file" id="csvFile" accept=".csv" />
        </div>

        <button id="btnImportCsv" type="button" class="btn-primary">
          Importer ‚ñ∂‚ñ∂
        </button>

        <p id="importStatus" class="status"></p>
      </section>

      <!-- Onglets stats Billets / Restauration -->
      <section class="card">
        <h2>üìä Statistiques</h2>

        <div class="stats-tabs">
          <button id="btnShowStatsBillets" type="button" class="stats-tab active-tab">
            Billets
          </button>
          <button id="btnShowStatsResto" type="button" class="stats-tab">
            Restauration
          </button>
        </div>

        <!-- Carte Stats Billets -->
        <section id="card-stats-billets">

          <div class="stats-header-row">
            <button id="refreshStatsBilletsBtn" class="btn-primary" type="button">
              Actualiser les stats
            </button>

            <div class="stats-period-selector">
              <label for="statsBilletsPeriod">P√©riode :</label>
              <select id="statsBilletsPeriod">
                <option value="today">Aujourd'hui</option>
                <option value="yesterday">Hier</option>
                <option value="this_week" selected>Semaine en cours</option>
                <option value="last_7_days">7 derniers jours</option>
                <option value="this_month">Mois en cours</option>
                <option value="last_month">Mois dernier</option>
                <option value="custom">P√©riode personnalis√©e</option>
              </select>
              <div class="date-range">
                <input type="date" id="statsBilletsDateStart" />
                <span>au</span>
                <input type="date" id="statsBilletsDateEnd" />
              </div>
            </div>
          </div>

          <p class="status">
            Les montants sont calcul√©s √† partir de la collection <strong>validations</strong>
            (billets d'entr√©e + billets internes) pour la p√©riode s√©lectionn√©e.
          </p>

          <div class="stats-grid">
            <div class="stat-item">
              <h3>Billets valid√©s</h3>
              <p id="stat-validations-count">0</p>
            </div>
            <div class="stat-item">
              <h3>Recette totale billets</h3>
              <p id="stat-revenue-total">0 GNF</p>
            </div>
            <div class="stat-item">
              <h3>Recette tarif normal</h3>
              <p id="stat-revenue-normal">0 GNF</p>
            </div>
            <div class="stat-item">
              <h3>Recette tarif √©tudiant</h3>
              <p id="stat-revenue-etudiant">0 GNF</p>
            </div>
          </div>

          <h3 style="margin-top:2rem;">D√©tail par type d'acc√®s</h3>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Type d'acc√®s / billet</th>
                  <th>Nb validations</th>
                  <th>Recette (GNF)</th>
                </tr>
              </thead>
              <tbody id="stats-type-body">
                <!-- rempli par JS -->
              </tbody>
            </table>
          </div>

          <p id="stats-billets-message" class="message"></p>
        </section>

        <!-- Carte Stats Restauration -->
        <section id="card-stats-resto" style="display:none; margin-top:1.5rem;">

          <div class="stats-header-row">
            <button id="refreshStatsRestoBtn" class="btn-primary" type="button">
              Actualiser les stats
            </button>

            <div class="stats-period-selector">
              <label for="statsRestoPeriod">P√©riode :</label>
              <select id="statsRestoPeriod">
                <option value="today">Aujourd'hui</option>
                <option value="yesterday">Hier</option>
                <option value="this_week" selected>Semaine en cours</option>
                <option value="last_7_days">7 derniers jours</option>
                <option value="this_month">Mois en cours</option>
                <option value="last_month">Mois dernier</option>
                <option value="custom">P√©riode personnalis√©e</option>
              </select>
              <div class="date-range">
                <input type="date" id="statsRestoDateStart" />
                <span>au</span>
                <input type="date" id="statsRestoDateEnd" />
              </div>
            </div>
          </div>

          <p class="status">
            Donn√©es issues de la collection <strong>ventes_resto</strong> pour la p√©riode choisie.
          </p>

          <div class="stats-grid">
            <div class="stat-item">
              <h3>Tickets (commandes)</h3>
              <p id="stat-resto-tickets">0</p>
            </div>
            <div class="stat-item">
              <h3>Plats vendus</h3>
              <p id="stat-resto-plats">0</p>
            </div>
            <div class="stat-item">
              <h3>Recette restauration</h3>
              <p id="stat-resto-revenue">0 GNF</p>
            </div>
          </div>

          <h3 style="margin-top:2rem;">D√©tail par produit</h3>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Code produit</th>
                  <th>Libell√©</th>
                  <th>Qt√© vendue</th>
                  <th>Recette (GNF)</th>
                </tr>
              </thead>
              <tbody id="stats-resto-body">
                <!-- rempli par JS -->
              </tbody>
            </table>
          </div>

          <p id="stats-resto-message" class="message"></p>
        </section>

      </section>

      <!-- Maintenance -->
      <section class="card">
        <h2>üßπ Maintenance des donn√©es</h2>

        <p class="status" style="margin-bottom:0.8rem;">
          Ce bouton supprime tous les billets d'entr√©e et billets internes dans Appwrite
          (<strong>billets</strong> + <strong>billets_interne</strong>).<br />
          Les validations ne sont pas supprim√©es (elles peuvent √™tre export√©es/archiv√©es s√©par√©ment une fois par an).
        </p>

        <button id="clearDataBtn" class="btn-danger" type="button">
          Effacer TOUS les billets (entr√©e + internes)
        </button>
      </section>

    </div> <!-- /admin-zone-gestion -->

  </div> <!-- /admin-app-zone -->

</main>

<footer>
  <p>¬© Centre de loisirs ‚Äì Administration</p>
</footer>

<!-- SDK Appwrite -->
<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
<!-- Script admin (version √† ajuster si besoin) -->
<script src="js/admin-appwrite.js?v=4"></script>

</body>
</html>
